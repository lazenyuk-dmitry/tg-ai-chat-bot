# ü§ñ TG AiChat Bot

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram-–±–æ—Ç –Ω–∞ aiogram 3, –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ API —Å–µ—Ä–≤–∏—Å–∞ AI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞.
–ò–ø–æ–ª—å–∑—É–µ—Ç Gemini –∏ PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

C—Å—ã–ª–∫–∞ –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –±–æ—Ç [AiChat Bot](https://t.me/ai_chat_xbot)

–í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∑–∞–ø—É—Å–∫–∞ –≤ docker –¥–ª—è production –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.
–î–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–±—Ä–∞–Ω Gemini (gemini-2.5-flash) —Ç–∞–∫ –∫–∞–∫ –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ.
Gemini –≤—Ä–æ–¥–µ –±—ã —É–º–µ–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–∞–º–æ–º—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ PostgreSQL (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π).
–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –±–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –∏–Ω—Å—Ç–∞–Ω—Å–µ Oracle Cloud Free Tier.

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:

- Clean Architecture
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- Dependency Injection
- Async-first –ø–æ–¥—Ö–æ–¥
- Alembic –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- Python 3.12+
- Docker
- aiogram 3
- SQLAlchemy 2 (async)
- PostgreSQL
- Alembic
- genai
- pip

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg-chatgpt-bot/
‚îÇ
‚îú‚îÄ‚îÄ alembic/           # –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ versions/
‚îÇ   ‚îî‚îÄ‚îÄ env.py
|
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ bot/                # —Ä–æ—É—Ç–µ—Ä—ã, —Ö–µ–Ω–¥–ª–µ—Ä—ã, telegram-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ services/           # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (ChatGPT, —Ä–∞–±–æ—Ç–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/         # ORM –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session.py      # —Å–æ–∑–¥–∞–Ω–∏–µ AsyncSession
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base.py         # Base metadata
‚îÇ   ‚îú‚îÄ‚îÄ config.py           # Pydantic settings
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ
‚îú‚îÄ‚îÄ alembic.ini
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements-dev.txt    # –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ requirements.txt        # –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md
```

---

## ‚öôÔ∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:

```bash
git clone https://github.com/yourname/tg-chatgpt-bot.git
cd tg-chatgpt-bot
```

2Ô∏è‚É£ –°–æ–∑–¥–∞–π .env —Ñ–∞–π–ª (–º–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å .env.example -> .env) –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cp .env.example .env
```

```ini
BOT_TOKEN=XXX
AI_API_KEY=XXX
DB_USER=admin
DB_PASSWORD=admin
DB_NAME=tg-ai-bot
DB_HOST="localhost" # –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ "localhost" –¥–ª—è –ø—Ä–æ–¥–∞ db
DB_PORT=5432
```

---

## üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker (production)

```bash
docker compose up -d
```

---

## üõ†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (development)

1Ô∏è‚É£ –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python -m venv venv
source venv/bin/activate  # Linux / Mac
venv\Scripts\activate     # Windows
```

2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements-dev.txt
```

3Ô∏è‚É£ –ü–æ–¥–Ω—è—Ç—å —Å–µ—Ä–≤–∏—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ docker –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

```bash
docker compose up db -d
```

4Ô∏è‚É£ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–æ–≥—Ä–∞—Ü–∏–∏

```bash
alembic upgrade head
```

5Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

- –ó–∞–ø—É—Å–∫ —Å–æ —Å–ª–µ–∂–µ–Ω–∏–µ–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:

```bash
watchmedo auto-restart --patterns="*.py;*.env" --recursive -- python -m app.main
```

- –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é):

```bash
python -m app.main
```
